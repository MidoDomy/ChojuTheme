{% sw_extends '@Storefront/storefront/base.html.twig' %}

{% block base_header %}
    {# Go through all categories #}
    {% macro getCategoryContent(categories, id) %}
        {% for category in categories %}
            {% if category.id == id %}
                {{ true }}
            {% else %}
                {{ _self.getCategoryContent(category.children, id) }}
            {% endif %}
        {% endfor %}
    {% endmacro %}

    {# Check if category has teaser image - start #}
    {% set currentCategory = page.header.navigation.active %}
    {% set isHomepage = _self.getCategoryContent(page.header.navigation.tree, currentCategory.id) %}
    {% set hasTeaser = currentCategory.media ? true : false %}

    {% if not('1' in isHomepage) and not(controllerAction|lower == 'home') or controllerName|lower == 'product' %}
        {% set hasTeaser = false %}
    {% endif %}
    {# Check if category has teaser image - end #}

    <header class="header-main{% if not(hasTeaser) %} header-dark{% endif %}{% if hasTeaser %} position-absolute{% endif %}">
        {% block base_header_inner %}
            <div class="container-fluid">
                {% sw_include '@Storefront/storefront/layout/header/header.html.twig' %}
            </div>
        {% endblock %}
    </header>
{% endblock %}

{% block base_navigation %}{% endblock %}

{% block base_offcanvas_navigation %}
    {# Removed offcanvas navigation - dropdown implemented in header #}

    {# Category teaser #}
        {# Go through all categories #}
    {% macro getCategoryContent(categories, id) %}
        {% for category in categories %}
            {% if category.id == id %}
                {{ true }}
            {% else %}
                {{ _self.getCategoryContent(category.children, id) }}
            {% endif %}
        {% endfor %}
    {% endmacro %}

    {# Check if category has teaser image - start #}
    {% set currentCategory = page.header.navigation.active %}
    {% set isHomepage = _self.getCategoryContent(page.header.navigation.tree, currentCategory.id) %}
    {% set hasTeaser = currentCategory.media ? true : false %}

    {% if not('1' in isHomepage) and not(controllerAction|lower == 'home') or controllerName|lower == 'product' %}
        {% set hasTeaser = false %}
    {% endif %}
    {# Check if it has teaser image - end #}
    
    {% if hasTeaser %}
        {% sw_include '@Storefront/storefront/component/custom/category-teaser.html.twig' with {
            category: currentCategory
        } %}
    {% endif %}

    {# Fixed global action buttons #}
    {% sw_include '@Storefront/storefront/component/custom/global-actions.html.twig' %}
{% endblock %}

{% block base_main_inner %}
    {% block base_main_container %}
        <div class="container-main">
            {% block base_breadcrumb %}
                {{ parent() }}
            {% endblock %}

            <div class="container">
                {% block base_content %}{% endblock %}
            </div>
        </div>
    {% endblock %}
{% endblock %}

{% block base_scroll_up %}{% endblock %}
